openapi: 3.0.3
info:
  title: Damacorch Personal API
  version: 1.0.0
  description: |
    전체 페이지 설계를 기반으로 정리한 Damacorch Personal 서비스의 OpenAPI 스펙입니다.
servers:
  - url: https://api.example.com
    description: Production server (예시 URL)

paths:
  ####################################################
  # Auth
  ####################################################
  /api/auth/signup:
    post:
      summary: 회원가입
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignupRequest'
      responses:
        '200':
          description: 회원가입 성공 (자동 로그인 포함 시)
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/AuthTokensResponse'
                  - $ref: '#/components/schemas/SignupSimpleResponse'
  /api/auth/login:
    post:
      summary: 이메일/비밀번호 로그인
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: 로그인 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthTokensResponse'
  /api/auth/logout:
    post:
      summary: 로그아웃 (토큰/세션 무효화)
      tags: [Auth]
      responses:
        '200':
          description: 로그아웃 성공
  /api/auth/me:
    get:
      summary: 현재 로그인 유저 정보 조회
      tags: [Auth]
      responses:
        '200':
          description: 로그인 상태
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSummary'
        '401':
          description: 비로그인 상태

  ####################################################
  # Analysis Results / Mypage
  ####################################################
  /api/analysis-results/{id}:
    get:
      summary: 분석 결과 상세 조회
      tags: [Analysis]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 분석 결과 데이터
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalysisResultDetail'
  /api/users/{userId}/analysis-results:
    get:
      summary: 유저별 분석 결과 목록 조회
      tags: [Analysis]
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
        - name: pageSize
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
      responses:
        '200':
          description: 분석 결과 목록
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PagedAnalysisResults'
  /api/analysis-results:
    post:
      summary: 분석 결과 생성 (내부용)
      tags: [Analysis]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnalysisResultCreateRequest'
      responses:
        '200':
          description: 생성된 분석 결과 ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  createdAt:
                    type: string
                    format: date-time
  /api/mypage:
    get:
      summary: 마이페이지 초기 데이터 조회
      tags: [Mypage]
      responses:
        '200':
          description: 유저 정보 + 최근 분석 결과
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MypageResponse'
  /api/analysis/start:
    post:
      summary: 새 성향분석 세션 시작 (선택)
      tags: [Mypage]
      responses:
        '200':
          description: 분석 세션 및 리다이렉트 경로
          content:
            application/json:
              schema:
                type: object
                properties:
                  analysisSessionId:
                    type: integer
                  redirectPath:
                    type: string

  ####################################################
  # Psy Test
  ####################################################
  /api/psy-test/questions:
    get:
      summary: 심리 검사 문항 목록 조회
      tags: [PsyTest]
      responses:
        '200':
          description: 문항 리스트
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PsyQuestion'
  /api/psy-test/submit:
    post:
      summary: 심리 검사 응답 제출
      tags: [PsyTest]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PsySubmitRequest'
      responses:
        '200':
          description: 분석 결과로 리다이렉트 정보 반환
          content:
            application/json:
              schema:
                type: object
                properties:
                  analysisResultId:
                    type: integer
                  redirectPath:
                    type: string

  ####################################################
  # Self Check
  ####################################################
  /api/self-check:
    get:
      summary: 셀프 체크 폼 초기 데이터 조회
      tags: [SelfCheck]
      responses:
        '200':
          description: 유저 기본 정보 및 최근 셀프 체크 값
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SelfCheckInitResponse'
  /api/self-check/submit:
    post:
      summary: 셀프 체크 제출
      tags: [SelfCheck]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SelfCheckSubmitRequest'
      responses:
        '200':
          description: 저장 결과
          content:
            application/json:
              schema:
                type: object
                properties:
                  selfCheckId:
                    type: integer
                  message:
                    type: string

  ####################################################
  # Home / Quests
  ####################################################
  /api/home:
    get:
      summary: 홈 화면 요약 데이터 조회
      tags: [Home, Quests]
      responses:
        '200':
          description: 홈 화면용 유저/캐릭터/퀘스트 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HomeResponse'
  /api/quests:
    get:
      summary: 오늘의 일일 퀘스트와 이번 주 주간 퀘스트 목록 조회
      tags: [Quests]
      parameters:
        - name: date
          in: query
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: 퀘스트 목록
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestsResponse'
  /api/quests/{userQuestId}:
    patch:
      summary: 개별 퀘스트 상태 변경
      tags: [Quests]
      parameters:
        - name: userQuestId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuestStatusUpdateRequest'
      responses:
        '200':
          description: 변경된 상태
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestStatusUpdateResponse'
  /api/quests/bulk-status:
    patch:
      summary: 여러 퀘스트 상태 일괄 변경
      tags: [Quests]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuestBulkStatusRequest'
      responses:
        '200':
          description: 변경된 개수
          content:
            application/json:
              schema:
                type: object
                properties:
                  updatedCount:
                    type: integer

  ####################################################
  # Quest History
  ####################################################
  /api/quest-history:
    get:
      summary: 특정 날짜의 퀘스트 히스토리 조회
      tags: [QuestHistory]
      parameters:
        - name: date
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: 해당 날짜의 일간/주간 퀘스트 히스토리
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestHistoryByDateResponse'
  /api/quest-history/summary:
    get:
      summary: 월 단위 퀘스트 히스토리 요약
      tags: [QuestHistory]
      parameters:
        - name: year
          in: query
          required: true
          schema:
            type: integer
        - name: month
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 날짜별 퀘스트 요약 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestHistorySummaryResponse'

  ####################################################
  # SNS Import
  ####################################################
  /api/sns/channels:
    get:
      summary: 지원 SNS 채널 목록 조회
      tags: [SNS]
      responses:
        '200':
          description: 채널 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SnsChannel'
  /api/me/sns-accounts:
    get:
      summary: 유저 SNS 연동 현황 조회
      tags: [SNS]
      responses:
        '200':
          description: 채널별 연동 상태
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserSnsAccount'
  /api/sns/import:
    post:
      summary: SNS 연동/가져오기 트리거
      tags: [SNS]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                snsChannelCode:
                  type: string
      responses:
        '200':
          description: OAuth URL 또는 동기화 시작 상태
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/SnsAuthUrlResponse'
                  - $ref: '#/components/schemas/SnsImportStartedResponse'

  ####################################################
  # App Settings
  ####################################################
  /api/app-settings/public:
    get:
      summary: 공개 앱 설정(로고 URL 등) 조회
      tags: [AppSettings]
      responses:
        '200':
          description: 공개 설정 값
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppSettingsPublicResponse'

components:
  schemas:
    ##################################################
    # 공통 스키마
    ##################################################
    UserSummary:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
          format: email
        name:
          type: string
    AuthTokensResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/UserSummary'
        accessToken:
          type: string
        refreshToken:
          type: string
    SignupSimpleResponse:
      type: object
      properties:
        userId:
          type: integer
        message:
          type: string

    ##################################################
    # Auth 요청 바디
    ##################################################
    SignupRequest:
      type: object
      required: [name, age, gender, email, password, passwordConfirm]
      properties:
        name:
          type: string
        age:
          type: integer
        gender:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
        passwordConfirm:
          type: string
    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string

    ##################################################
    # Analysis
    ##################################################
    AnalysisResultDetail:
      type: object
      properties:
        id:
          type: integer
        userId:
          type: integer
        characterName:
          type: string
        characterImageUrl:
          type: string
        summary:
          type: string
        tendency:
          type: object
          properties:
            personality:
              type: string
            behaviorPattern:
              type: string
        preference:
          type: object
          properties:
            likes:
              type: string
            dislikes:
              type: string
        coaching:
          type: object
          properties:
            tips:
              type: string
        createdAt:
          type: string
          format: date-time
    AnalysisResultListItem:
      type: object
      properties:
        id:
          type: integer
        characterName:
          type: string
        summary:
          type: string
        createdAt:
          type: string
          format: date-time
    PagedAnalysisResults:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/AnalysisResultListItem'
        totalCount:
          type: integer
    AnalysisResultCreateRequest:
      type: object
      properties:
        userId:
          type: integer
        characterName:
          type: string
        characterImageUrl:
          type: string
        summary:
          type: string
        tendencyPersonality:
          type: string
        tendencyBehaviorPattern:
          type: string
        preferenceLikes:
          type: string
        preferenceDislikes:
          type: string
        coachingTips:
          type: string

    MypageResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/UserSummary'
        recentAnalysisResults:
          type: array
          items:
            $ref: '#/components/schemas/AnalysisResultListItem'

    ##################################################
    # Psy Test
    ##################################################
    PsyQuestion:
      type: object
      properties:
        id:
          type: integer
        order:
          type: integer
        text:
          type: string
        scaleMin:
          type: integer
        scaleMax:
          type: integer
    PsyAnswer:
      type: object
      properties:
        questionId:
          type: integer
        value:
          type: integer
    PsySubmitRequest:
      type: object
      properties:
        sessionId:
          type: integer
          nullable: true
        answers:
          type: array
          items:
            $ref: '#/components/schemas/PsyAnswer'

    ##################################################
    # Self Check
    ##################################################
    SelfCheckInitResponse:
      type: object
      properties:
        user:
          type: object
          properties:
            id:
              type: integer
            name:
              type: string
            age:
              type: integer
            gender:
              type: string
        lastSelfCheck:
          type: object
          nullable: true
          properties:
            hobby:
              type: string
            sleepPattern:
              type: string
            exerciseFlag:
              type: boolean
            exercisePerWeek:
              type: integer
            exerciseType:
              type: string
            petType:
              type: string
            mbti:
              type: string
            outingPerWeek:
              type: integer
            speechAudioUrl:
              type: string
            selfIntroDocUrl:
              type: string
    SelfCheckSubmitRequest:
      type: object
      properties:
        hobby:
          type: string
        sleepPattern:
          type: string
        exerciseFlag:
          type: boolean
        exercisePerWeek:
          type: integer
        exerciseType:
          type: string
        petType:
          type: string
        mbti:
          type: string
        outingPerWeek:
          type: integer
        speechAudioPath:
          type: string
        selfIntroDocPath:
          type: string

    ##################################################
    # Home / Quests
    ##################################################
    QuestItem:
      type: object
      properties:
        userQuestId:
          type: integer
        title:
          type: string
        description:
          type: string
        status:
          type: string
    HomeResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/UserSummary'
        character:
          type: object
          properties:
            name:
              type: string
            imageUrl:
              type: string
            status:
              type: string
        dailyQuests:
          type: array
          items:
            $ref: '#/components/schemas/QuestItem'
        weeklyQuest:
          $ref: '#/components/schemas/QuestItem'
          nullable: true
    QuestsResponse:
      type: object
      properties:
        daily:
          type: array
          items:
            $ref: '#/components/schemas/QuestItem'
        weekly:
          type: array
          items:
            $ref: '#/components/schemas/QuestItem'
    QuestStatusUpdateRequest:
      type: object
      properties:
        status:
          type: string
    QuestStatusUpdateResponse:
      type: object
      properties:
        userQuestId:
          type: integer
        status:
          type: string
    QuestBulkStatusRequest:
      type: object
      properties:
        userQuestIds:
          type: array
          items:
            type: integer
        status:
          type: string

    QuestHistoryByDateResponse:
      type: object
      properties:
        date:
          type: string
          format: date
        dailyQuests:
          type: array
          items:
            $ref: '#/components/schemas/QuestItem'
        weeklyQuests:
          type: array
          items:
            $ref: '#/components/schemas/QuestItem'
    QuestHistorySummaryDay:
      type: object
      properties:
        date:
          type: string
          format: date
        hasQuest:
          type: boolean
        completedCount:
          type: integer
        totalCount:
          type: integer
    QuestHistorySummaryResponse:
      type: object
      properties:
        year:
          type: integer
        month:
          type: integer
        days:
          type: array
          items:
            $ref: '#/components/schemas/QuestHistorySummaryDay'

    ##################################################
    # SNS
    ##################################################
    SnsChannel:
      type: object
      properties:
        id:
          type: integer
        code:
          type: string
        name:
          type: string
        iconUrl:
          type: string
    UserSnsAccount:
      type: object
      properties:
        snsChannel:
          $ref: '#/components/schemas/SnsChannel'
        status:
          type: string
        displayName:
          type: string
    SnsAuthUrlResponse:
      type: object
      properties:
        authUrl:
          type: string
    SnsImportStartedResponse:
      type: object
      properties:
        status:
          type: string
        message:
          type: string

    ##################################################
    # App Settings
    ##################################################
    AppSettingsPublicResponse:
      type: object
      properties:
        serviceLogoUrl:
          type: string
        serviceName:
          type: string
